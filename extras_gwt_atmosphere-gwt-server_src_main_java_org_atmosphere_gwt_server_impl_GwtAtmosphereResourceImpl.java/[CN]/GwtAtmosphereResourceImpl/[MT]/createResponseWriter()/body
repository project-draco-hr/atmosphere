{
  String transport=atmResource.getRequest().getParameter("tr");
  if ("WebSocket".equals(transport)) {
    logger.debug("atmosphere-gwt Using websocket");
    return new WebsocketResponseWriter(this);
  }
 else   if ("HTTPRequest".equals(transport)) {
    logger.debug("atmosphere-gwt Using XMLHttpRequest");
    return new HTTPRequestResponseWriter(this);
  }
 else   if ("IFrame".equals(transport)) {
    logger.debug("atmosphere-gwt Using streaming IFrame");
    return new IFrameResponseWriter(this);
  }
 else   if ("OperaEventSource".equals(transport)) {
    logger.debug("atmosphere-gwt Using Opera EventSource");
    return new OperaEventSourceResponseWriter(this);
  }
 else   if ("IEXDomainRequest".equals(transport)) {
    logger.debug("atmosphere-gwt Using IE XDomainRequest");
    return new IEXDomainRequestResponseWriter(this);
  }
 else   if ("IEHTMLFile".equals(transport)) {
    logger.debug("atmosphere-gwt Using IE html file iframe");
    return new IEHTMLFileResponseWriter(this);
  }
 else {
    throw new IllegalStateException("Failed to determine responsewriter");
  }
}
