{
  AsyncSupport cs;
  List<Class<? extends AsyncSupport>> l;
  if (!useWebsocketIfPossible) {
    cs=resolve(useNativeIfPossible,defaultToBlocking);
  }
 else {
    boolean use30=false;
    String s=config.getInitParameter(ApplicationConfig.WEBSOCKET_SUPPORT_SERVLET3);
    if (s != null) {
      use30=Boolean.valueOf(s);
    }
    if (use30) {
      l=detectServlet3WebSocketPresent();
    }
 else {
      l=detectWebSocketPresent(useNativeIfPossible);
    }
    if (l.isEmpty()) {
      return resolve(useNativeIfPossible,defaultToBlocking);
    }
    cs=resolveWebSocket(l);
  }
  if (cs == null) {
    return new BlockingIOCometSupport(config);
  }
 else {
    return cs;
  }
}
