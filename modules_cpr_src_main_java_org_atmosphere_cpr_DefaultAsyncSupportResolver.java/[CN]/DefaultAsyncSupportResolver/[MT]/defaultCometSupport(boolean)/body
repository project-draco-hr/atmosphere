{
  if (!preferBlocking && testClassExists(SERVLET_30)) {
    if (detectWebSocketPresent().size() > 0) {
      return new Servlet30AsyncSupportWithWebSocket(config);
    }
    return new Servlet30CometSupport(config);
  }
 else {
    return new BlockingIOCometSupport(config);
  }
}
