{
  if (event.isCancelled()) {
    return;
  }
  int count=0;
  if (event.getMessage() instanceof Integer) {
    count=((Integer)event.getMessage()).intValue();
  }
  try {
    event.getResource().getResponse().addHeader("X-JSON","{\"counter\":" + count + " }");
    PrintWriter writer=event.getResource().getResponse().getWriter();
    writer.write("success");
    writer.flush();
  }
  finally {
    if (!event.isResumedOnTimeout()) {
      event.getResource().resume();
    }
  }
}
