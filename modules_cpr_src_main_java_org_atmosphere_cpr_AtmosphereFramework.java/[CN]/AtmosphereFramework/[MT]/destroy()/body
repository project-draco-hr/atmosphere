{
  if (asyncSupport != null && AsynchronousProcessor.class.isAssignableFrom(asyncSupport.getClass())) {
    ((AsynchronousProcessor)asyncSupport).shutdown();
  }
  for (  Entry<String,AtmosphereHandlerWrapper> entry : atmosphereHandlers.entrySet()) {
    AtmosphereHandlerWrapper handlerWrapper=entry.getValue();
    handlerWrapper.atmosphereHandler.destroy();
  }
  String s=config.getInitParameter(ApplicationConfig.SHARED);
  if (s != null && s.equalsIgnoreCase("true")) {
    logger.warn("Factory shared, will not be destroyed. That can possibly cause memory leaks if" + "Broadcaster where created. Make sure you destroy them manually.");
    return this;
  }
  BroadcasterFactory factory=BroadcasterFactory.getDefault();
  if (factory != null) {
    factory.destroy();
    BroadcasterFactory.factory=null;
  }
  return this;
}
