{
  if (webSocketProtocolInitialized)   return;
  if (webSocketProtocol == null) {
    try {
      webSocketProtocol=(WebSocketProtocol)newClassInstance(Thread.currentThread().getContextClassLoader().loadClass(webSocketProtocolClassName));
      logger.info("Installed WebSocketProtocol {} ",webSocketProtocolClassName);
    }
 catch (    Exception ex) {
      try {
        webSocketProtocol=(WebSocketProtocol)newClassInstance(AtmosphereFramework.class.getClassLoader().loadClass(webSocketProtocolClassName));
        logger.info("Installed WebSocketProtocol {} ",webSocketProtocolClassName);
      }
 catch (      Exception ex2) {
        logger.error("Cannot load the WebSocketProtocol {}",getWebSocketProtocolClassName(),ex);
        try {
          webSocketProtocol=newClassInstance(SimpleHttpProtocol.class);
        }
 catch (        Exception e) {
        }
      }
    }
  }
  webSocketProtocolInitialized=true;
  webSocketProtocol.configure(config);
}
