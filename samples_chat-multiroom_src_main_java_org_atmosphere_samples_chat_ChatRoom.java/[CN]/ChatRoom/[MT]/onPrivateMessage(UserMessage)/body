{
  String userUUID=users.get(user.getUser());
  if (userUUID != null) {
    AtmosphereResource r=AtmosphereResourceFactory.getDefault().find(userUUID);
    if (r != null) {
      ChatProtocol m=new ChatProtocol(user.getUser()," sent you a private message: " + user.getMessage().split(":")[1],users.keySet(),factory.lookupAll());
      if (!user.getUser().equalsIgnoreCase("all")) {
        factory.lookup(mappedPath).broadcast(m,r);
      }
    }
  }
 else {
    ChatProtocol m=new ChatProtocol(user.getUser()," sent a message to all chatroom: " + user.getMessage().split(":")[1],users.keySet(),factory.lookupAll());
    MetaBroadcaster.getDefault().broadcastTo("/*",m);
  }
}
