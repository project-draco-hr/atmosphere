{
  if (binaryWrite) {
    byte[] b=webSocketResponseFilter.filter(r,data).getBytes(resource().getResponse().getCharacterEncoding());
    if (b != null)     webSocket.send(b);
  }
 else {
    String s=webSocketResponseFilter.filter(r,data);
    if (s != null)     webSocket.send(s);
  }
  lastWrite=System.currentTimeMillis();
  return this;
}
