{
  System.err.println("\n\nTEST idleWebSocketTest\n\n");
  final AsyncHttpClient client=getAsyncHttpClient(new AsyncHttpClientConfig.Builder().setFollowRedirects(true).build());
  final String sessionid1=getSessionID(client,GET_SESSION_URL);
  final CountDownLatch l=new CountDownLatch(2);
  WebSocketWrapper wrapper=new WebSocketWrapper();
  wrapper.setListener(new WebSocketResponseListener(wrapper){
    @Override public void onClose(){
      System.err.println("onClose called");
    }
    @Override public void notify(    String message){
      log.info("clientWebSocket1 message received = " + message);
      Assert.assertNotNull(message);
      List<SocketIOPacketImpl> messages=null;
      try {
        messages=SocketIOPacketImpl.parse(message);
      }
 catch (      SocketIOException e1) {
        e1.printStackTrace();
      }
      if (messages == null || messages.isEmpty()) {
        return;
      }
      for (      SocketIOPacketImpl msg : messages) {
        String data=msg.toString();
switch (msg.getFrameType()) {
case CONNECT:
          Assert.assertEquals(message,"1::");
        l.countDown();
      break;
case HEARTBEAT:
    Assert.assertEquals(message,"2::");
  l.countDown();
default :
}
}
}
}
);
WebSocket websocket=connectWS("clientWebSocket1",client,WS_GET_SESSION_URL + "websocket/" + sessionid1,wrapper).websocket;
if (!l.await(45,TimeUnit.SECONDS)) {
throw new RuntimeException("Timeout out");
}
client.close();
}
