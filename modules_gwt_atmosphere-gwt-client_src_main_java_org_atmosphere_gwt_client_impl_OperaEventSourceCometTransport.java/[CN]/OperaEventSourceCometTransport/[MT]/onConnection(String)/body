{
  if (message.startsWith("c")) {
    connected=true;
    String initParameters=message.substring(1);
    try {
      String[] params=initParameters.split(":");
      connectionId=Integer.parseInt(params[1]);
      listener.onConnected(Integer.parseInt(params[0]),connectionId);
    }
 catch (    NumberFormatException e) {
      listener.onError(new AtmosphereClientException("Unexpected init parameters: " + initParameters),true);
    }
  }
 else   if (message.startsWith("e")) {
    disconnect();
    String status=message.substring(1);
    try {
      int statusCode;
      String statusMessage;
      int index=status.indexOf(' ');
      if (index == -1) {
        statusCode=Integer.parseInt(status);
        statusMessage=null;
      }
 else {
        statusCode=Integer.parseInt(status.substring(0,index));
        statusMessage=HTTPRequestCometTransport.unescape(status.substring(index + 1));
      }
      listener.onError(new StatusCodeException(statusCode,statusMessage),false);
    }
 catch (    NumberFormatException e) {
      listener.onError(new AtmosphereClientException("Unexpected status code: " + status),false);
    }
  }
 else   if (message.equals("d")) {
    connected=false;
    disconnect();
    listener.onDisconnected();
  }
 else   if (message.equals("h")) {
    listener.onHeartbeat();
  }
 else {
    listener.onError(new AtmosphereClientException("Unexpected connection status: " + message),true);
  }
}
