{
  r.set(resource);
  resource.addEventListener(new AtmosphereResourceEventListenerAdapter(){
    @Override public void onSuspend(    AtmosphereResourceEvent event){
      AtmosphereRequest request=new AtmosphereRequest.Builder().pathInfo("/h").method("POST").body("message").build();
      try {
        event.getResource().addEventListener(new AtmosphereResourceEventListenerAdapter(){
          @Override public void onBroadcast(          AtmosphereResourceEvent event){
            latch.get().countDown();
          }
        }
);
        event.getResource().getAtmosphereConfig().framework().doCometSupport(request,AtmosphereResponse.newInstance());
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
catch (      ServletException e) {
        e.printStackTrace();
      }
    }
  }
).suspend();
}
