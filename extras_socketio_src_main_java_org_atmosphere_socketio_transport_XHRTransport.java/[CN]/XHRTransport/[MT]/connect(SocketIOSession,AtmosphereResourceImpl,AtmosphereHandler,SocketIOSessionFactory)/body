{
  if (session == null) {
    session=sessionFactory.createSession(resource,atmosphereHandler);
    resource.getRequest().setAttribute(SocketIOAtmosphereHandler.SOCKETIO_SESSION_ID,session.getSessionId());
    resource.getRequest().setAttribute(SocketIOAtmosphereHandler.SOCKETIO_SESSION_OUTBOUND,atmosphereHandler);
  }
  XHRSessionHelper handler=createHelper(session);
  handler.connect(resource,atmosphereHandler);
  return session;
}
