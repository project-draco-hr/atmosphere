{
  ByteArrayOutputStream b=new ByteArrayOutputStream();
  final WebSocket w=new ArrayBaseWebSocket(b);
  final WebSocketProcessor processor=WebSocketProcessorFactory.getDefault().getWebSocketProcessor(framework);
  processor.registerWebSocketHandler("/a",new EchoHandler());
  processor.registerWebSocketHandler("/b",new EchoHandler());
  AtmosphereRequest request=new AtmosphereRequest.Builder().destroyable(false).body("a").pathInfo("/a").build();
  processor.open(w,request);
  processor.invokeWebSocketProtocol(w,"a");
  assertEquals(b.toString(),"a");
  request=new AtmosphereRequest.Builder().destroyable(false).body("b").pathInfo("/b").build();
  processor.open(w,request);
  processor.invokeWebSocketProtocol(w,"b");
  assertEquals(b.toString(),"ab");
}
