{
  r.getRequest().setAttribute(FrameworkConfig.ATMOSPHERE_RESOURCE,r);
  r.getRequest().setAttribute(FrameworkConfig.ATMOSPHERE_HANDLER,this);
  try {
    if (!wrapRequest) {
      wrapper.service(r.getRequest(),r.getResponse());
    }
 else {
      wrapper.service(new AtmosphereRequestWrapper(r.getRequest()),new AtmosphereResponseWrapper(r.getResponse()));
    }
  }
 catch (  Throwable ex) {
    logger.error("onRequest()",ex);
    throw new RuntimeException(ex);
  }
}
