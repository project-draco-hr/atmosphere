{
  HttpServletRequest req=httpEvent.getHttpServletRequest();
  HttpServletResponse res=httpEvent.getHttpServletResponse();
  req.setAttribute(JBossWebCometSupport.HTTP_EVENT,httpEvent);
  if (!framework.isCometSupportSpecified && !framework.isCometSupportConfigured.getAndSet(true)) {
synchronized (framework.asyncSupport) {
      if (!framework.asyncSupport.getClass().equals(JBossWebCometSupport.class)) {
        AsyncSupport current=framework.asyncSupport;
        logger.warn("JBossWebCometSupport is enabled, switching to it");
        framework.asyncSupport=new JBossWebCometSupport(framework.config);
        if (current instanceof AsynchronousProcessor) {
          ((AsynchronousProcessor)current).shutdown();
        }
        framework.asyncSupport.init(framework.config.getServletConfig());
      }
    }
  }
  framework.doCometSupport(AtmosphereRequest.wrap(req),AtmosphereResponse.wrap(res));
}
