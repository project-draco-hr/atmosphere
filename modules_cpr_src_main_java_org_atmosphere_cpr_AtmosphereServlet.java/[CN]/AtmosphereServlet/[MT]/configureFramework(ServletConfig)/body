{
  if (framework == null) {
    if (sc.getServletContext().getMajorVersion() > 2) {
      try {
        framework=(AtmosphereFramework)sc.getServletContext().getAttribute(sc.getServletContext().getServletRegistration(sc.getServletName()).getName());
      }
 catch (      UnsupportedOperationException ex) {
        logger.trace("",ex);
      }
    }
    if (framework == null) {
      framework=newAtmosphereFramework();
    }
  }
  framework.init(sc);
  return this;
}
