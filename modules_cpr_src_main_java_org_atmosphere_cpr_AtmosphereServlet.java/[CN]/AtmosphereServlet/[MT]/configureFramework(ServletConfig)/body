{
  if (framework == null) {
    if (sc.getServletContext().getMajorVersion() > 2) {
      framework=(AtmosphereFramework)sc.getServletContext().getAttribute(sc.getServletContext().getServletRegistration(sc.getServletName()).getName());
    }
    if (framework == null) {
      framework=newAtmosphereFramework();
    }
  }
  framework.init(sc);
  return this;
}
