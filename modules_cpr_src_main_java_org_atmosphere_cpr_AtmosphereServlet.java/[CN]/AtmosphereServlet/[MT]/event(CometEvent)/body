{
  HttpServletRequest req=cometEvent.getHttpServletRequest();
  HttpServletResponse res=cometEvent.getHttpServletResponse();
  req.setAttribute(TomcatCometSupport.COMET_EVENT,cometEvent);
  if (!framework.isCometSupportSpecified && !framework.isCometSupportConfigured.getAndSet(true)) {
synchronized (framework.cometSupport) {
      if (!framework.cometSupport.getClass().equals(TomcatCometSupport.class)) {
        logger.warn("TomcatCometSupport is enabled, switching to it");
        framework.cometSupport=new TomcatCometSupport(framework.config);
      }
    }
  }
  framework.doCometSupport(AtmosphereRequest.wrap(req),AtmosphereResponse.wrap(res));
}
