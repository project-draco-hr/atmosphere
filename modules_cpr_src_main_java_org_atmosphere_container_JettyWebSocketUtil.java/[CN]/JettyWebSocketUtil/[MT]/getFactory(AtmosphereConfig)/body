{
  WebSocketFactory webSocketFactory=new WebSocketFactory(new WebSocketFactory.Acceptor(){
    public boolean checkOrigin(    HttpServletRequest request,    String origin){
      logger.trace("WebSocket-checkOrigin request {} with origin {}",request.getRequestURI(),origin);
      return true;
    }
    public org.eclipse.jetty.websocket.WebSocket doWebSocketConnect(    HttpServletRequest request,    String protocol){
      logger.trace("WebSocket-connect request {} with protocol {}",request.getRequestURI(),protocol);
      return new JettyWebSocketHandler(AtmosphereRequest.cloneRequest(request,false,config.isSupportSession()),config.framework(),config.framework().getWebSocketProtocol());
    }
  }
);
  int bufferSize=8192;
  if (config.getInitParameter(ApplicationConfig.WEBSOCKET_BUFFER_SIZE) != null) {
    bufferSize=Integer.valueOf(config.getInitParameter(ApplicationConfig.WEBSOCKET_BUFFER_SIZE));
  }
  logger.info("WebSocket Buffer side {}",bufferSize);
  webSocketFactory.setBufferSize(bufferSize);
  int timeOut=5 * 60000;
  if (config.getInitParameter(ApplicationConfig.WEBSOCKET_IDLETIME) != null) {
    timeOut=Integer.valueOf(config.getInitParameter(ApplicationConfig.WEBSOCKET_IDLETIME));
  }
  logger.info("WebSocket idle timeout {}",timeOut);
  webSocketFactory.setMaxIdleTime(timeOut);
  int maxTextBufferSize=8192;
  if (config.getInitParameter(ApplicationConfig.WEBSOCKET_MAXTEXTSIZE) != null) {
    maxTextBufferSize=Integer.valueOf(config.getInitParameter(ApplicationConfig.WEBSOCKET_MAXTEXTSIZE));
  }
  logger.info("WebSocket maxTextBufferSize {}",maxTextBufferSize);
  webSocketFactory.setMaxTextMessageSize(maxTextBufferSize);
  int maxBinaryBufferSize=8192;
  if (config.getInitParameter(ApplicationConfig.WEBSOCKET_MAXBINARYSIZE) != null) {
    maxBinaryBufferSize=Integer.valueOf(config.getInitParameter(ApplicationConfig.WEBSOCKET_MAXBINARYSIZE));
  }
  logger.info("WebSocket maxBinaryBufferSize {}",maxBinaryBufferSize);
  webSocketFactory.setMaxBinaryMessageSize(maxBinaryBufferSize);
  return webSocketFactory;
}
