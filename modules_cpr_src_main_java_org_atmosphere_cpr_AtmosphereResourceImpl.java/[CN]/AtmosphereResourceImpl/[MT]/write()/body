{
  try {
    if (useWriter && !((Boolean)req.getAttribute(AtmosphereServlet.PROPERTY_USE_STREAM))) {
      try {
        res.getWriter();
      }
 catch (      IllegalStateException e) {
        return;
      }
      res.getWriter().write(beginCompatibleData);
      res.getWriter().flush();
    }
 else {
      try {
        res.getOutputStream();
      }
 catch (      IllegalStateException e) {
        return;
      }
      res.getOutputStream().write(beginCompatibleData.getBytes());
      res.getOutputStream().flush();
    }
  }
 catch (  Throwable ex) {
    LoggerUtils.getLogger().log(Level.WARNING,"",ex);
  }
}
