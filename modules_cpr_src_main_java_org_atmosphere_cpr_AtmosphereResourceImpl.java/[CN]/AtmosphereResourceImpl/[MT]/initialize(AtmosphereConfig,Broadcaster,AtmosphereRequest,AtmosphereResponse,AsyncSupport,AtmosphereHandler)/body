{
  this.req=req;
  this.response=response;
  this.broadcaster=broadcaster;
  this.config=config;
  this.asyncSupport=asyncSupport;
  this.atmosphereHandler=atmosphereHandler;
  this.event=new AtmosphereResourceEventImpl(this);
  String s=(String)req.getAttribute(SUSPENDED_ATMOSPHERE_RESOURCE_UUID);
  if (s == null) {
    s=response.getHeader(HeaderConfig.X_ATMOSPHERE_TRACKING_ID);
  }
  uuid=s == null ? UUID.randomUUID().toString() : s;
  if (config.isSupportSession()) {
    try {
      session=req.getSession(true);
    }
 catch (    NullPointerException ex) {
      logger.trace("http://java.net/jira/browse/GLASSFISH-18856",ex);
    }
  }
  transport=configureTransport();
  register();
  return this;
}
