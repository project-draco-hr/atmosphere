{
  this.req=req;
  this.response=response;
  this.broadcaster=broadcaster;
  this.config=config;
  this.asyncSupport=asyncSupport;
  this.atmosphereHandler=atmosphereHandler;
  this.event=new AtmosphereResourceEventImpl(this);
  String nocache=config.getInitParameter(ApplicationConfig.NO_CACHE_HEADERS);
  injectCacheHeaders=nocache != null ? false : true;
  String ac=config.getInitParameter(ApplicationConfig.DROP_ACCESS_CONTROL_ALLOW_ORIGIN_HEADER);
  enableAccessControl=ac != null ? !Boolean.parseBoolean(ac) : true;
  String wh=config.getInitParameter(FrameworkConfig.WRITE_HEADERS);
  writeHeaders=wh != null ? Boolean.parseBoolean(wh) : true;
  req.setAttribute(ApplicationConfig.NO_CACHE_HEADERS,injectCacheHeaders);
  req.setAttribute(ApplicationConfig.DROP_ACCESS_CONTROL_ALLOW_ORIGIN_HEADER,enableAccessControl);
  String s=response.getHeader(HeaderConfig.X_ATMOSPHERE_TRACKING_ID);
  uuid=s == null ? UUID.randomUUID().toString() : s;
  if (config.isSupportSession()) {
    try {
      session=req.getSession(true);
    }
 catch (    NullPointerException ex) {
      logger.trace("http://java.net/jira/browse/GLASSFISH-18856",ex);
    }
  }
}
