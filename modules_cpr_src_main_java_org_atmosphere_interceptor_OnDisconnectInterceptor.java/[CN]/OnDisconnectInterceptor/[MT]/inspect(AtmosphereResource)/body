{
  AtmosphereRequest request=AtmosphereResourceImpl.class.cast(r).getRequest(false);
  String s=request.getHeader(HeaderConfig.X_ATMOSPHERE_TRANSPORT);
  String uuid=r.uuid();
  if (p != null && s != null && s.equalsIgnoreCase(HeaderConfig.DISCONNECT_TRANSPORT_MESSAGE)) {
    logger.trace("AtmosphereResource {} disconnected",uuid);
    AtmosphereResource ss=AtmosphereResourceFactory.getDefault().find(uuid);
    if (ss != null) {
      AtmosphereResourceImpl.class.cast(ss).getRequest(false).setAttribute(ASYNCHRONOUS_HOOK,null);
      AtmosphereResourceEventImpl.class.cast(ss.getAtmosphereResourceEvent()).isClosedByClient(true);
      p.completeLifecycle(ss,false);
    }
 else {
      logger.debug("Was unable to execute onDisconnect on {}",r.uuid());
    }
    return Action.CANCELLED;
  }
  return Action.CONTINUE;
}
