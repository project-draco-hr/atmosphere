{
  AtmosphereRequest req=resource.getRequest();
  AtmosphereResponse res=resource.getResponse();
  if (req.getHeader("Origin") != null) {
    res.addHeader("Access-Control-Allow-Origin",req.getHeader("Origin"));
    res.addHeader("Access-Control-Expose-Headers","X-Cache-Date, X-Atmosphere-tracking-id");
    res.setHeader("Access-Control-Allow-Credentials","true");
  }
  if ("OPTIONS".equals(req.getMethod())) {
    res.setHeader("Access-Control-Allow-Methods","OPTIONS, GET, POST");
    res.setHeader("Access-Control-Allow-Headers","Origin, Content-Type, X-Atmosphere-Framework, X-Cache-Date, X-Atmosphere-tracking-id, X-Atmosphere-Transport");
    res.setHeader("Access-Control-Max-Age","-1");
    final AtomicReference<String> emptyMessage=new AtomicReference<String>("");
    res.write(emptyMessage.get());
    return Action.SKIP_ATMOSPHEREHANDLER;
  }
  return Action.CONTINUE;
}
