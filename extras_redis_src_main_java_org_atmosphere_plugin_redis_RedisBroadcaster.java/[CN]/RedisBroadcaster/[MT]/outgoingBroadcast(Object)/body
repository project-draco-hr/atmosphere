{
  Object lockingObject=sharedPool ? jedisPool : jedisPublisher;
  boolean valid=true;
synchronized (lockingObject) {
    try {
      if (sharedPool) {
        jedisPublisher=jedisPool.getResource();
        auth(jedisPublisher);
      }
      jedisPublisher.publish(getID(),message.toString());
    }
 catch (    JedisException e) {
      logger.warn("outgoingBroadcast exception",e);
      valid=false;
    }
 finally {
      if (sharedPool) {
        if (!valid) {
          jedisPool.returnBrokenResource(jedisPublisher);
        }
 else {
          jedisPool.returnResource(jedisPublisher);
        }
        if (!valid) {
          outgoingBroadcast(message);
        }
      }
    }
  }
}
