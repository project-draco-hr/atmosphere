{
  if (uri == null)   return;
  if (config != null) {
    if (config.getServletConfig().getInitParameter(REDIS_AUTH) != null) {
      authToken=config.getServletConfig().getInitParameter(REDIS_AUTH);
    }
    if (config.getServletConfig().getInitParameter(REDIS_SERVER) != null) {
      uri=URI.create(config.getServletConfig().getInitParameter(REDIS_SERVER));
    }
  }
  jedisSubscriber=new Jedis(uri.getHost(),uri.getPort());
  try {
    jedisSubscriber.connect();
    if (authToken != null) {
      jedisSubscriber.auth(authToken);
    }
    jedisSubscriber.flushAll();
  }
 catch (  IOException e) {
    logger.error("failed to connect subscriber",e);
    try {
      jedisSubscriber.disconnect();
    }
 catch (    IOException e1) {
      logger.error("failed to disconnect subscriber",e);
    }
  }
  jedisPublisher=new Jedis(uri.getHost(),uri.getPort());
  try {
    jedisPublisher.connect();
    if (authToken != null) {
      jedisPublisher.auth(authToken);
    }
    jedisPublisher.flushAll();
  }
 catch (  IOException e) {
    logger.error("failed to connect publisher",e);
    try {
      jedisPublisher.disconnect();
    }
 catch (    IOException e1) {
      logger.error("failed to disconnect publisher",e);
    }
  }
}
