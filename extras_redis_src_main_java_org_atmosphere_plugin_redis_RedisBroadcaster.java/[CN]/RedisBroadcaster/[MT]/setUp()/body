{
  if (uri == null)   return;
  if (config != null) {
    if (config.getServletConfig().getInitParameter(REDIS_AUTH) != null) {
      authToken=config.getServletConfig().getInitParameter(REDIS_AUTH);
    }
    if (config.getServletConfig().getInitParameter(REDIS_SERVER) != null) {
      uri=URI.create(config.getServletConfig().getInitParameter(REDIS_SERVER));
    }
  }
  if (jedisPool == null) {
    GenericObjectPool.Config config=new GenericObjectPool.Config();
    config.testOnBorrow=true;
    config.testWhileIdle=true;
    jedisPool=new JedisPool(config,uri.getHost(),uri.getPort());
  }
 else {
    jedisPool.returnResource(jedisPublisher);
    jedisPool.returnResource(jedisSubscriber);
  }
  jedisSubscriber=jedisPool.getResource();
  try {
    jedisSubscriber.connect();
  }
 catch (  IOException e) {
    logger.error("failed to connect subscriber",e);
  }
  jedisSubscriber.auth(authToken);
  jedisSubscriber.flushAll();
  jedisPublisher=jedisPool.getResource();
  try {
    jedisPublisher.connect();
  }
 catch (  IOException e) {
    logger.error("failed to connect publisher",e);
  }
  jedisPublisher.auth(authToken);
  jedisPublisher.flushAll();
}
