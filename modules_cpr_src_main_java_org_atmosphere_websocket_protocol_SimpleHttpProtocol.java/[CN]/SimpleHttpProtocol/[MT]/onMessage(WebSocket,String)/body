{
  AtmosphereResourceImpl resource=(AtmosphereResourceImpl)webSocket.resource();
  if (resource == null) {
    logger.trace("The WebSocket has been closed before the message was processed.");
    return null;
  }
  AtmosphereRequest request=resource.getRequest(false);
  if (!resource.isInScope())   return Collections.emptyList();
  String pathInfo=request.getPathInfo();
  String requestURI=request.getRequestURI();
  if (message.startsWith(delimiter)) {
    int delimiterLength=delimiter.length();
    int bodyBeginIndex=message.indexOf(delimiter,delimiterLength);
    if (bodyBeginIndex != -1) {
      pathInfo=message.substring(delimiterLength,bodyBeginIndex);
      requestURI+=pathInfo;
      message=message.substring(bodyBeginIndex + delimiterLength);
    }
  }
  List<AtmosphereRequest> list=new ArrayList<AtmosphereRequest>();
  list.add(constructRequest(resource,pathInfo,requestURI,methodType,contentType,destroyable).body(message).build());
  return list;
}
