{
  AtmosphereResourceImpl resource=(AtmosphereResourceImpl)webSocket.resource();
  if (resource == null) {
    logger.trace("The WebSocket has been closed before the message was processed.");
    return null;
  }
  AtmosphereRequest request=resource.getRequest();
  String pathInfo=request.getPathInfo();
  String requestURI=request.getRequestURI();
  if (d.startsWith(delimiter)) {
    int delimiterLength=delimiter.length();
    int bodyBeginIndex=d.indexOf(delimiter,delimiterLength);
    if (bodyBeginIndex != -1) {
      pathInfo=d.substring(delimiterLength,bodyBeginIndex);
      requestURI+=pathInfo;
      d=d.substring(bodyBeginIndex + delimiterLength);
    }
  }
  Map<String,Object> m=attributes(request);
  List<AtmosphereRequest> list=new ArrayList<AtmosphereRequest>();
  list.add(new AtmosphereRequest.Builder().request(request).method(methodType).contentType(contentType).body(d).attributes(m).pathInfo(pathInfo).requestURI(requestURI).destroyable(destroyable).headers(request.headersMap()).session(resource.session()).build());
  return list;
}
