{
  logger.trace("Initializing AtmosphereFramework");
  framework=(AtmosphereFramework)c.getAttribute(AtmosphereFramework.class.getName());
  if (framework == null) {
    framework=new AtmosphereFramework(false,true);
    DefaultAsyncSupportResolver resolver=new DefaultAsyncSupportResolver(framework.getAtmosphereConfig());
    List<Class<? extends AsyncSupport>> l=resolver.detectWebSocketPresent(false,true);
    if (l.size() == 0 && resolver.testClassExists(DefaultAsyncSupportResolver.JSR356_WEBSOCKET)) {
      framework.setAsyncSupport(new JSR356AsyncSupport(new AtmosphereConfig(framework){
        public ServletContext getServletContext(){
          return c;
        }
        public String getInitParameter(        String name){
          return c.getInitParameter(name);
        }
        public Enumeration<String> getInitParameterNames(){
          return c.getInitParameterNames();
        }
      }
));
    }
    c.setAttribute(AtmosphereFramework.class.getName(),framework);
  }
}
