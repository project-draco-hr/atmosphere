{
  if (req.getAttribute(ATMOSPHERE) == null) {
    return;
  }
  CometHandler handler=getCometHandler(ctx,(Integer)req.getAttribute(ATMOSPHERE));
  req.removeAttribute(ATMOSPHERE);
  if (handler == null && supportSession() && req.getSession(false) != null) {
    handler=getCometHandler(ctx,(Integer)req.getSession(false).getAttribute(ATMOSPHERE));
    req.getSession().removeAttribute(ATMOSPHERE);
  }
  if (handler != null && (config.getInitParameter(ApplicationConfig.RESUME_AND_KEEPALIVE) == null || config.getInitParameter(ApplicationConfig.RESUME_AND_KEEPALIVE).equalsIgnoreCase("false"))) {
    try {
      ctx.resumeCometHandler(handler);
    }
 catch (    IOException e) {
      logger.error("Error resuming CometHandler",e);
    }
  }
}
