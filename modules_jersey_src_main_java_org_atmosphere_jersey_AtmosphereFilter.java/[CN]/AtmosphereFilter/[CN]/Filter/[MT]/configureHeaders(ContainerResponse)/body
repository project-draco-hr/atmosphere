{
  boolean webSocketSupported=servletReq.getAttribute(WebSocket.WEBSOCKET_SUSPEND) != null;
  if (servletReq.getHeaders("Connection") != null && servletReq.getHeaders("Connection").hasMoreElements()) {
    String[] e=((Enumeration<String>)servletReq.getHeaders("Connection")).nextElement().split(",");
    for (    String upgrade : e) {
      if (upgrade != null && upgrade.equalsIgnoreCase(WEBSOCKET_UPGRADE)) {
        if (!webSocketSupported) {
          response.getHttpHeaders().putSingle(X_ATMOSPHERE_ERROR,"Websocket protocol not supported");
        }
      }
    }
  }
  boolean injectCacheHeaders=(Boolean)servletReq.getAttribute(ApplicationConfig.NO_CACHE_HEADERS);
  boolean enableAccessControl=(Boolean)servletReq.getAttribute(ApplicationConfig.DROP_ACCESS_CONTROL_ALLOW_ORIGIN_HEADER);
  if (injectCacheHeaders) {
    response.getHttpHeaders().putSingle(EXPIRES,"-1");
    response.getHttpHeaders().putSingle(CACHE_CONTROL,"no-store, no-cache, must-revalidate");
    response.getHttpHeaders().putSingle(PRAGMA,"no-cache");
  }
  if (enableAccessControl) {
    response.getHttpHeaders().putSingle(ACCESS_CONTROL_ALLOW_ORIGIN,"*");
    response.getHttpHeaders().putSingle(ACCESS_CONTROL_ALLOW_CREDENTIALS,"true");
  }
}
