{
  final AtmosphereResponse response=r.getResponse();
  super.inspect(r);
  AsyncIOWriter writer=response.getAsyncIOWriter();
  if (AtmosphereInterceptorWriter.class.isAssignableFrom(writer.getClass())) {
    AtmosphereInterceptorWriter.class.cast(writer).interceptor(new AsyncIOInterceptor(){
      @Override public void prePayload(      AtmosphereResponse response,      byte[] data,      int offset,      int length){
      }
      @Override public byte[] transformPayload(      AtmosphereResponse response,      byte[] responseDraft,      byte[] data) throws IOException {
        return responseDraft;
      }
      @Override public void postPayload(      AtmosphereResponse response,      byte[] data,      int offset,      int length){
        response.write(end);
      }
    }
);
  }
 else {
    logger.warn("Unable to apply {}. Your AsyncIOWriter must implement {}",getClass().getName(),AtmosphereInterceptorWriter.class.getName());
  }
  return Action.CONTINUE;
}
