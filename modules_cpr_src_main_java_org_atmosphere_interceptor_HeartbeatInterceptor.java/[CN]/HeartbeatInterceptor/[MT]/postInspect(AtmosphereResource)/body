{
  if (!onHeartbeatListeners.containsKey(r.uuid())) {
    final Queue<AtmosphereResourceEventListener> listeners=AtmosphereResourceImpl.class.cast(r).listeners();
    for (    final AtmosphereResourceEventListener l : listeners) {
      if (AtmosphereResourceEventListenerAdapter.OnHeartbeat.class.isAssignableFrom(l.getClass())) {
        r.addEventListener(new AtmosphereResourceEventListenerAdapter.OnDisconnect(){
          public void onDisconnect(          final AtmosphereResourceEvent event){
            onHeartbeatListeners.remove(event.getResource().uuid());
          }
        }
);
        onHeartbeatListeners.put(r.uuid(),l);
        break;
      }
    }
  }
}
