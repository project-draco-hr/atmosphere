{
  getResponse().setHeader("Cache-Control","no-cache");
  getResponse().setCharacterEncoding("UTF-8");
  OutputStream outputStream=getResponse().getOutputStream();
  outputStream=getOutputStream(outputStream);
  if (supportsDeflate()) {
    String acceptEncoding=getRequest().getHeader("Accept-Encoding");
    if (acceptEncoding != null && acceptEncoding.contains("deflate")) {
      getResponse().setHeader("Content-Encoding","deflate");
      outputStream=new DeflaterOutputStream(outputStream);
    }
  }
  writer=new OutputStreamWriter(outputStream,"UTF-8");
  if (logger.isTraceEnabled()) {
    logger.trace("Initiated [" + connectionID + "]");
  }
  getRequest().setAttribute("connectionID",connectionID);
  scheduleHeartbeat();
}
