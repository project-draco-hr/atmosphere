{
  String userAgent=request.getHeader("User-Agent") == null ? "" : request.getHeader("User-Agent").toLowerCase();
  String transport=request.getHeader(X_ATMOSPHERE_TRANSPORT) == null ? STREAMING_TRANSPORT : request.getHeader(X_ATMOSPHERE_TRANSPORT).toString();
  if (transport.equals(STREAMING_TRANSPORT) && userAgent.startsWith("opera")) {
    StringBuilder sb=new StringBuilder("<script id=\"atmosphere_").append(uniqueScriptToken.getAndIncrement()).append("\">").append("window.parent.$.atmosphere.streamingCallback").append("('").append(message.toString()).append("');</script>");
    message=sb.toString();
    return new BroadcastAction(BroadcastAction.ACTION.CONTINUE,message);
  }
  return new BroadcastAction(BroadcastAction.ACTION.CONTINUE,message);
}
