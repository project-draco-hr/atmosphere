{
  String userAgent=request.getHeader("User-Agent") == null ? "" : request.getHeader("User-Agent").toLowerCase();
  String transport=request.getHeader("X-Atmosphere-Transport") == null ? "streaming" : request.getHeader("X-Atmosphere-Transport").toString();
  if (transport.equals("streaming") && userAgent.startsWith("opera")) {
    StringBuilder sb=new StringBuilder("<script id=\"atmosphere_").append(uniqueScriptToken.getAndIncrement()).append("\">").append("window.parent.$.atmosphere.streamingCallback").append("('").append(message.toString()).append("');</script>");
    message=sb.toString();
    return new BroadcastAction(BroadcastAction.ACTION.CONTINUE,message);
  }
  return new BroadcastAction(BroadcastAction.ACTION.CONTINUE,message);
}
