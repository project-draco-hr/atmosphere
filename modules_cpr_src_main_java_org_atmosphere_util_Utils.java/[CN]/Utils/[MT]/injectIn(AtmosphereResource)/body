{
  AtmosphereHandler h=r.getAtmosphereHandler();
  if (AtmosphereFramework.REFLECTOR_ATMOSPHEREHANDLER.getClass().isAssignableFrom(h.getClass())) {
    return WebSocketProcessor.WebSocketHandlerProxy.class.cast(AtmosphereResourceImpl.class.cast(r).webSocket().webSocketHandler()).proxied();
  }
 else   if (ManagedAtmosphereHandler.class.isAssignableFrom(h.getClass())) {
    return AnnotatedProxy.class.cast(h).target();
  }
 else   if (ReflectorServletProcessor.class.isAssignableFrom(h.getClass())) {
    return ReflectorServletProcessor.class.cast(h).getServlet();
  }
 else {
    return h;
  }
}
