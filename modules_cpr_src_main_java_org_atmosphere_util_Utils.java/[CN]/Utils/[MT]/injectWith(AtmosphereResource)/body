{
  if (r == null || r.getAtmosphereHandler() == null || AtmosphereResourceImpl.class.cast(r).webSocket() == null || AtmosphereResourceImpl.class.cast(r).webSocket().webSocketHandler() == null) {
    return null;
  }
  AtmosphereHandler h=r.getAtmosphereHandler();
  if (AtmosphereFramework.REFLECTOR_ATMOSPHEREHANDLER.getClass().isAssignableFrom(h.getClass())) {
    return WebSocketProcessor.WebSocketHandlerProxy.class.cast(AtmosphereResourceImpl.class.cast(r).webSocket().webSocketHandler()).proxied();
  }
 else {
    return injectWith(h);
  }
}
