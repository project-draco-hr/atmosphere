{
  AtmosphereConfig config=r.getAtmosphereConfig();
  if (config.properties().get(FrameworkConfig.NEED_RUNTIME_INJECTION) == null) {
    return;
  }
  AtmosphereObjectFactory injectableFactory=config.framework().objectFactory();
  if (!InjectableObjectFactory.class.isAssignableFrom(injectableFactory.getClass())) {
    return;
  }
  Object injectIn=injectIn(r);
  if (injectIn != null) {
    String name=Thread.currentThread().getName() + AtmosphereResource.class.getSimpleName();
    try {
      config.properties().put(name,r);
      inject(injectIn,injectIn.getClass(),config);
    }
  finally {
      config.properties().remove(name);
    }
  }
}
