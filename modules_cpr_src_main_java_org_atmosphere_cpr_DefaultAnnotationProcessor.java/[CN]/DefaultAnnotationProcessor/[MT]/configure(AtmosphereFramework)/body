{
  ServletContext sc=framework.getServletContext();
  Map<Class<? extends Annotation>,Set<Class<?>>> annotations=(Map<Class<? extends Annotation>,Set<Class<?>>>)sc.getAttribute(ANNOTATION_ATTRIBUTE);
  sc.removeAttribute(ANNOTATION_ATTRIBUTE);
  boolean scanForAtmosphereAnnotation=false;
  if (annotations == null || annotations.isEmpty()) {
    delegate=new BytecodeBasedAnnotationProcessor(handler);
    scanForAtmosphereAnnotation=true;
  }
 else {
    Map<Class<? extends Annotation>,Set<Class<?>>> clone=new HashMap<Class<? extends Annotation>,Set<Class<?>>>();
    clone.putAll(annotations);
    delegate=new ServletContainerInitializerAnnotationProcessor(handler,clone,framework);
  }
  logger.info("AnnotationProcessor {} being used",delegate.getClass());
  if (scanForAtmosphereAnnotation) {
    scanForAnnotation(framework);
  }
  delegate.configure(framework);
  return this;
}
