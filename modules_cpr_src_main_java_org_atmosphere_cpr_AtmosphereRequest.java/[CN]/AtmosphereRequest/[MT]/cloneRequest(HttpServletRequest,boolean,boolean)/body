{
  Builder b;
  HttpServletRequest r;
  boolean isWrapped=false;
  if (AtmosphereRequest.class.isAssignableFrom(request.getClass())) {
    b=AtmosphereRequest.class.cast(request).b;
    isWrapped=true;
    r=request;
  }
 else {
    b=new Builder();
    b.request(request);
  }
  b.servletPath(request.getServletPath()).pathInfo(request.getPathInfo()).contextPath(request.getContextPath()).requestURI(request.getRequestURI()).requestURL(request.getRequestURL().toString()).method(request.getMethod()).serverName(request.getServerName()).serverPort(request.getServerPort()).destroyable(false).session(copySession ? new FakeHttpSession(request.getSession(true)) : null);
  if (loadInMemory) {
    r=new NoOpsRequest();
    load(request,b);
    if (isWrapped) {
      load(b.request,b);
    }
    b.request(r);
  }
  return isWrapped ? AtmosphereRequest.class.cast(request) : b.build();
}
