{
  if (b.webSocketFakeSession != null) {
    return b.webSocketFakeSession;
  }
  if (resource() != null) {
    HttpSession session=AtmosphereResourceImpl.class.cast(resource()).session;
    if (session != null) {
      return session;
    }
  }
  try {
    return b.request.getSession(create);
  }
 catch (  java.lang.IllegalStateException ex) {
    if (ex.getMessage() != null || ex.getMessage().equalsIgnoreCase("No Session Manager")) {
      return null;
    }
    throw ex;
  }
catch (  NullPointerException ex) {
    return b.request.getSession(create);
  }
}
