{
  Builder b=null;
  boolean isWrapped=false;
  if (AtmosphereRequest.class.isAssignableFrom(request.getClass())) {
    b=AtmosphereRequest.class.cast(request).b;
    isWrapped=true;
  }
 else {
    b=new Builder();
    b.request(request);
  }
  b.servletPath(request.getServletPath()).pathInfo(request.getPathInfo()).contextPath(request.getContextPath()).requestURI(request.getRequestURI()).requestURL(request.getRequestURL().toString()).method(request.getMethod()).serverName(request.getServerName()).serverPort(request.getServerPort()).destroyable(false).session(new FakeHttpSession(request.getSession(true)));
  Enumeration<String> e=request.getHeaderNames();
  String s;
  while (e.hasMoreElements()) {
    s=e.nextElement();
    b.headers.put(s,request.getHeader(s));
  }
  e=request.getAttributeNames();
  while (e.hasMoreElements()) {
    s=e.nextElement();
    b.localAttributes.put(s,request.getAttribute(s));
  }
  e=request.getParameterNames();
  while (e.hasMoreElements()) {
    s=e.nextElement();
    b.queryStrings.put(s,request.getParameterValues(s));
  }
  return isWrapped ? AtmosphereRequest.class.cast(request) : b.build();
}
