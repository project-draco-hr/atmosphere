{
  Builder b;
  boolean isWrapped=false;
  if (AtmosphereRequest.class.isAssignableFrom(request.getClass())) {
    b=AtmosphereRequest.class.cast(request).b;
    isWrapped=true;
  }
 else {
    b=new Builder();
  }
  load(request,b);
  if (isWrapped) {
    load(b.request,b);
  }
  b.servletPath(request.getServletPath()).pathInfo(request.getPathInfo()).contextPath(request.getContextPath()).requestURI(request.getRequestURI()).requestURL(request.getRequestURL().toString()).method(request.getMethod()).serverName(request.getServerName()).serverPort(request.getServerPort()).destroyable(false).session(new FakeHttpSession(request.getSession(true))).request(new NoOpsRequest());
  return isWrapped ? AtmosphereRequest.class.cast(request) : b.build();
}
