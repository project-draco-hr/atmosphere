{
  if (config == null) {
    configure();
  }
  if (webSocketWriteTimeout != -1)   webSocketConnection.getWebSocketContext().setTimeoutSecs(webSocketWriteTimeout);
  if (maxTextBufferSize != -1)   webSocketConnection.getWebSocketContext().setMaxMessageSize(maxTextBufferSize);
  WebSocket webSocket=new WebLogicWebSocket(webSocketConnection,config);
  webSocketConnection.getWebSocketContext().getServletContext().setAttribute(webSocketConnection.toString(),webSocket);
  AtmosphereRequest ar=AtmosphereRequest.cloneRequest(request.get(),true,false,true);
  String pathInfo=ar.getPathInfo();
  String servletPath=ar.getServletPath();
  ar.pathInfo(null).servletPath(pathInfo).contextPath(ar.getContextPath() + servletPath);
  request.set(null);
  try {
    webSocketProcessor.open(webSocket,ar,AtmosphereResponse.newInstance(config,ar,webSocket));
  }
 catch (  IOException e) {
    logger.error("{}",e);
  }
}
