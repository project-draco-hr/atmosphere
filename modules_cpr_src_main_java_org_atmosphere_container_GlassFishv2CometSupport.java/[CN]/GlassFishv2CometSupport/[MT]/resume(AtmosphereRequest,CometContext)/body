{
  if (req.getAttribute(ATMOSPHERE) == null) {
    return;
  }
  CometHandler handler=ctx.getCometHandler((Integer)req.getAttribute(ATMOSPHERE));
  req.removeAttribute(ATMOSPHERE);
  if (handler == null && supportSession() && req.getSession(false) != null) {
    handler=ctx.getCometHandler((Integer)req.getSession(false).getAttribute(ATMOSPHERE));
    req.getSession().removeAttribute(ATMOSPHERE);
  }
  if (handler != null && (config.getInitParameter(ApplicationConfig.RESUME_AND_KEEPALIVE) == null || config.getInitParameter(ApplicationConfig.RESUME_AND_KEEPALIVE).equalsIgnoreCase("false"))) {
    ctx.resumeCometHandler(handler);
  }
}
