{
  if (!completed.getAndSet(true)) {
    invokeOnStateChange(r,e);
    executed.set(true);
  }
 else   if (!executed.get()) {
    onException(new IOException("Unable to write after " + writeTimeoutInSecond),r);
    AtmosphereResourceImpl.class.cast(r).cancel();
  }
  return null;
}
