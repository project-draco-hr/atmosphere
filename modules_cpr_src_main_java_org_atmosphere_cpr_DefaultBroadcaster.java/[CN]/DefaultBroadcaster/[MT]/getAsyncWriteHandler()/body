{
  return new Runnable(){
    public void run(){
      AsyncWriteToken token;
      try {
        token=asyncWriteQueue.take();
synchronized (token.resource) {
          if (AtmosphereResourceImpl.class.cast(token.resource).isInScope()) {
            bc.getAsyncWriteService().submit(this);
            executeAsyncWrite(token.resource,token.msg,token.future);
          }
        }
      }
 catch (      Throwable ex) {
        if (!started.get()) {
          logger.trace("failed to submit async write task on shutdown",ex);
        }
 else {
          logger.debug("failed to submit async write task",ex);
        }
      }
    }
  }
;
}
