{
  logger.debug("onException()",t);
  final AtmosphereResourceImpl r=AtmosphereResourceImpl.class.cast(ar);
  removeAtmosphereResource(r);
  final AtmosphereResourceEventImpl event=r.getAtmosphereResourceEvent();
  event.setThrowable(t);
  r.notifyListeners(event);
  r.removeEventListeners();
  if (bc != null && bc.getAsyncWriteService() != null) {
    bc.getAsyncWriteService().execute(new Runnable(){
      @Override public void run(){
        try {
          r.resume();
        }
 catch (        Throwable t) {
          logger.trace("Was unable to resume a corrupted AtmosphereResource {}",r);
          logger.trace("Cause",t);
        }
      }
    }
);
  }
 else {
    r.resume();
  }
  cacheLostMessage(r,(AsyncWriteToken)r.getRequest(false).getAttribute(ASYNC_TOKEN));
}
