{
  if (writeTimeoutInSecond != -1) {
    logger.debug("Registering write timeout {} for {}",writeTimeoutInSecond,r.uuid());
    WriteOperation w=new WriteOperation(r,e);
    bc.getScheduledExecutorService().schedule(w,writeTimeoutInSecond,TimeUnit.MILLISECONDS);
    try {
      w.call();
    }
 catch (    Exception ex) {
      logger.warn("",ex);
    }
  }
 else {
    try {
      r.getAtmosphereHandler().onStateChange(e);
    }
 catch (    Throwable t) {
      onException(t,r);
    }
  }
}
