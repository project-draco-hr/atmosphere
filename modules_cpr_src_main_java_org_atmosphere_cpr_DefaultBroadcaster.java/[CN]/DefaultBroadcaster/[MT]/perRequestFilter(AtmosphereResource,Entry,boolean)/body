{
  if (r == null) {
    logger.trace("Null AtmosphereResource passed inside a Set");
    return false;
  }
  if (isAtmosphereResourceValid(r)) {
    if (bc.hasPerRequestFilters()) {
      BroadcastAction a=bc.filter(r,msg.message,msg.originalMessage);
      if (a.action() == BroadcastAction.ACTION.ABORT) {
        return false;
      }
      msg.message=a.message();
    }
  }
 else {
    if (cache) {
      logger.warn("Request is no longer valid {}, Message {} will be cached",r.uuid(),msg.originalMessage);
      bc.getBroadcasterCache().addToCache(getID(),r,new BroadcastMessage(msg.originalMessage));
    }
    return false;
  }
  return true;
}
