{
  if (r == null) {
    logger.trace("Null AtmosphereResource passed inside a Set");
    return false;
  }
  if (isAtmosphereResourceValid(r)) {
    if (bc.hasPerRequestFilters()) {
      BroadcastAction a=bc.filter(r,msg.message,msg.originalMessage);
      if (a.action() == BroadcastAction.ACTION.ABORT) {
        return false;
      }
      msg.message=a.message();
    }
  }
 else {
    logger.warn("Request is not longer valid {}",r.uuid());
    removeAtmosphereResource(r);
    config.getBroadcasterFactory().removeAllAtmosphereResource(r);
    return false;
  }
  return true;
}
