{
  super(config);
  ServerContainer container=(ServerContainer)config.getServletContext().getAttribute(ServerContainer.class.getName());
  if (container == null) {
    throw new IllegalStateException("ServerContainer is null");
  }
  configurator=new AtmosphereConfigurator(config.framework());
  int pathLength=5;
  String s=config.getInitParameter(ApplicationConfig.JSR356_PATH_MAPPING_LENGTH);
  if (s != null) {
    pathLength=Integer.valueOf(s);
  }
  logger.trace("JSR356 Path mapping Size {}",pathLength);
  StringBuilder b=new StringBuilder(PATH).append("}");
  for (int i=0; i < pathLength; i++) {
    try {
      container.addEndpoint(ServerEndpointConfig.Builder.create(JSR356Endpoint.class,b.toString()).configurator(configurator).build());
    }
 catch (    DeploymentException e) {
      throw new RuntimeException(e);
    }
    b.append(PATH).append(i).append("}");
  }
}
