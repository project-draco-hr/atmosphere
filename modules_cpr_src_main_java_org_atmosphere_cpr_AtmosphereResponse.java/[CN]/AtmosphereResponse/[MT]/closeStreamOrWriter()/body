{
  if (resource() != null && resource().transport() != AtmosphereResource.TRANSPORT.WEBSOCKET) {
    try {
      boolean isUsingStream=(Boolean)request().getAttribute(PROPERTY_USE_STREAM);
      if (isUsingStream) {
        try {
          getOutputStream().close();
        }
 catch (        java.lang.IllegalStateException ex) {
          logger.trace("",ex);
        }
      }
 else {
        getWriter().close();
      }
    }
 catch (    IOException e) {
      logger.trace("",e);
    }
  }
}
