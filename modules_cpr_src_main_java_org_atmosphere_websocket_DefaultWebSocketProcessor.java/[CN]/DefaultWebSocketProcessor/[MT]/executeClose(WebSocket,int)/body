{
  boolean isClosedByClient=webSocket.resource() == null ? true : webSocket.resource().getAtmosphereResourceEvent().isClosedByClient();
  try {
    asynchronousProcessor.endRequest(AtmosphereResourceImpl.class.cast(webSocket.resource()),true);
  }
  finally {
    if (!isClosedByClient) {
      notifyListener(webSocket,new WebSocketEventListener.WebSocketEvent(closeCode,CLOSE,webSocket));
    }
  }
}
