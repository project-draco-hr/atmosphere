{
  WebSocketHandler webSocketHandler=webSocket.webSocketHandler();
  if (webSocketHandler == null) {
    List<AtmosphereRequest> list=webSocketProtocol.onMessage(webSocket,webSocketMessage);
    dispatch(webSocket,list);
  }
 else {
    try {
      webSocketHandler.onTextMessage(webSocket,webSocketMessage);
    }
 catch (    Exception ex) {
      webSocketHandler.onError(webSocket,new WebSocketException(ex,new AtmosphereResponse.Builder().request(webSocket.resource().getRequest()).status(500).statusMessage("Server Error").build()));
    }
  }
  notifyListener(webSocket,new WebSocketEventListener.WebSocketEvent(webSocketMessage,MESSAGE,webSocket));
}
