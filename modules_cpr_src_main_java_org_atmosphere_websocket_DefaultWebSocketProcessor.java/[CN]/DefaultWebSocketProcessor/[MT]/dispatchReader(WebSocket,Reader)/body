{
  int read=0;
  CharBuffer cb=webSocket.cb;
  while (read > -1) {
    cb.position(cb.position() + read);
    if (cb.remaining() == 0) {
      resizeCharBuffer(webSocket);
    }
    read=r.read(cb.array(),cb.position(),cb.remaining());
  }
  cb.flip();
  try {
    invokeWebSocketProtocol(webSocket,cb.toString());
  }
  finally {
    cb.clear();
  }
}
