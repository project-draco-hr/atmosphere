{
  String id=e.id;
  long now=System.currentTimeMillis();
  readWriteLock.writeLock().lock();
  try {
    boolean hasMessageWithSameId=messagesIds.contains(id);
    if (!hasMessageWithSameId) {
      logger.trace("Added {} to the cache",e.message);
      CacheMessage cacheMessage=new CacheMessage(id,now,e.message);
      messages.add(cacheMessage);
      messagesIds.add(id);
    }
  }
  finally {
    readWriteLock.writeLock().unlock();
  }
  if (r != null) {
    r.getResponse().setHeader(X_CACHE_DATE,String.valueOf(now));
  }
}
