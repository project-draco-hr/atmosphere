{
  SessionTimeoutSupport.restoreTimeout(request);
  AtmosphereResourceImpl r=(AtmosphereResourceImpl)request.getAttribute(FrameworkConfig.ATMOSPHERE_RESOURCE);
  if (r == null)   return Action.CANCELLED;
  AtmosphereHandler atmosphereHandler=(AtmosphereHandler)request.getAttribute(FrameworkConfig.ATMOSPHERE_HANDLER);
  AtmosphereResourceEvent event=r.getAtmosphereResourceEvent();
  if (event != null && event.isResuming() && !event.isCancelled()) {
synchronized (r) {
      atmosphereHandler.onStateChange(event);
    }
  }
  return Action.RESUME;
}
