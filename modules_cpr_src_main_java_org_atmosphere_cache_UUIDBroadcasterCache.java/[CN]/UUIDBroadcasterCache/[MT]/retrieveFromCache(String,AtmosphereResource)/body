{
  String clientId=uuid(r);
  long now=System.currentTimeMillis();
  List<Object> result=new ArrayList<Object>();
  ClientQueue clientQueue;
  activeClients.put(clientId,now);
  clientQueue=messages.remove(clientId);
  ConcurrentLinkedQueue<CacheMessage> clientMessages;
  if (clientQueue != null) {
    clientMessages=clientQueue.getQueue();
    for (    CacheMessage cacheMessage : clientMessages) {
      result.add(cacheMessage.getMessage());
    }
  }
  if (logger.isTraceEnabled()) {
    logger.trace("Retrieved for AtmosphereResource {} cached messages {}",r.uuid(),result);
    logger.trace("Available cached message {}",messages);
  }
  return result;
}
