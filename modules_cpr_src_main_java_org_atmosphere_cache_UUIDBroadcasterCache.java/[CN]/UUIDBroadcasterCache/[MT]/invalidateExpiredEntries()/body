{
  long now=System.currentTimeMillis();
  Set<String> inactiveClients=new HashSet<String>();
  for (  Map.Entry<String,Long> entry : activeClients.entrySet()) {
    if (now - entry.getValue() > clientIdleTime) {
      logger.trace("Invalidate client {}",entry.getKey());
      inactiveClients.add(entry.getKey());
    }
  }
  for (  String clientId : inactiveClients) {
    activeClients.remove(clientId);
    ClientQueue messageQueue=messages.remove(clientId);
    notifyRemoveCache(messageQueue);
  }
  for (  String clientId : messages().keySet()) {
    if (!activeClients().containsKey(clientId)) {
      ClientQueue messageQueue=messages().remove(clientId);
      notifyRemoveCache(messageQueue);
    }
  }
}
