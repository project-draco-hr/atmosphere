{
  Map<String,Object> m=new ConcurrentHashMap<String,Object>();
  m.put(FrameworkConfig.WEBSOCKET_SUBPROTOCOL,FrameworkConfig.SIMPLE_HTTP_OVER_WEBSOCKET);
  try {
    m.putAll(request.localAttributes());
  }
 catch (  Exception ex) {
    logger.trace("",ex);
    Map<String,Object> dup=Collections.unmodifiableMap(request.localAttributes());
    for (    Map.Entry<String,Object> e : dup.entrySet()) {
      if (e.getKey() != null) {
        m.put(e.getKey(),e.getValue());
      }
    }
  }
  return m;
}
