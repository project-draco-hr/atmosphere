{
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicReference<Boolean> deleted=new AtomicReference<Boolean>();
  BroadcasterListener l=new BroadcasterListener(){
    @Override public void onPostCreate(    Broadcaster b){
    }
    @Override public void onComplete(    Broadcaster b){
    }
    @Override public void onPreDestroy(    Broadcaster b){
      deleted.set(Boolean.TRUE);
      latch.countDown();
    }
  }
;
  BroadcasterFactory.getDefault().addBroadcasterListener(l).get("/b1").setBroadcasterLifeCyclePolicy(new BroadcasterLifeCyclePolicy.Builder().policy(BroadcasterLifeCyclePolicy.ATMOSPHERE_RESOURCE_POLICY.IDLE_DESTROY).idleTime(5,TimeUnit.SECONDS).build());
  latch.await(10,TimeUnit.SECONDS);
  assertTrue(deleted.get());
}
