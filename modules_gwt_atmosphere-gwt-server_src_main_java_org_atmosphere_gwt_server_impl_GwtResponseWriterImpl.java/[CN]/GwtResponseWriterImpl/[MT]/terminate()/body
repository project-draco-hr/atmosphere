{
  if (!terminated) {
    try {
      doTerminate();
      flush();
    }
  finally {
      setTerminated(true);
    }
  }
}
