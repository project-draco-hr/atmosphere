{
  CountDownLatch latch=new CountDownLatch(1);
  req.setAttribute(LATCH,latch.hashCode());
  latchs.put(latch.hashCode(),latch);
  if (supportSession()) {
    req.getSession().setAttribute(LATCH,latch.hashCode());
  }
  try {
    if (action.timeout != -1 && action.timeout < 30000) {
      latch.await(action.timeout,TimeUnit.MILLISECONDS);
    }
 else {
      latch.await(30000,TimeUnit.MILLISECONDS);
    }
  }
 catch (  InterruptedException ex) {
    LoggerUtils.getLogger().log(Level.SEVERE,"Unable to resume the suspended connection");
  }
 finally {
    timedout(req,res);
  }
}
