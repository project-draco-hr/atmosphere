{
  CountDownLatch latch=new CountDownLatch(1);
  req.setAttribute(LATCH,latch.hashCode());
  latchs.put(latch.hashCode(),latch);
  if (supportSession()) {
    req.getSession().setAttribute(LATCH,latch.hashCode());
  }
  try {
    if (action.timeout != -1 && action.timeout < 30000) {
      latch.await(action.timeout,TimeUnit.MILLISECONDS);
    }
 else {
      latch.await(20000,TimeUnit.MILLISECONDS);
    }
  }
 catch (  Throwable ex) {
    LoggerUtils.getLogger().log(Level.WARNING,"Unable to resume the suspended connection",ex);
  }
 finally {
    try {
      timedout(req,res);
    }
 catch (    Throwable e) {
      LoggerUtils.getLogger().log(Level.WARNING,"Unable to timeout connection",e);
    }
  }
}
