{
  Object o=event.getMessage();
  if (o == null || event.isCancelled())   return;
  if (event.getResource().getSerializer() != null) {
    try {
      event.getResource().getSerializer().write(event.getResource().getResponse().getOutputStream(),o);
    }
 catch (    Throwable ex) {
      LoggerUtils.getLogger().log(Level.WARNING,"Serializer exception",ex);
    }
  }
 else {
    boolean isUsingStream=false;
    try {
      event.getResource().getResponse().getWriter();
    }
 catch (    IllegalStateException e) {
      isUsingStream=true;
    }
    if (o instanceof List) {
      for (      String s : (List<String>)o) {
        if (isUsingStream) {
          event.getResource().getResponse().getOutputStream().write(s.getBytes());
          event.getResource().getResponse().getOutputStream().flush();
        }
 else {
          event.getResource().getResponse().getWriter().write(s);
          event.getResource().getResponse().getWriter().flush();
        }
      }
    }
 else {
      if (isUsingStream) {
        event.getResource().getResponse().getOutputStream().write(o.toString().getBytes());
        event.getResource().getResponse().getOutputStream().flush();
      }
 else {
        event.getResource().getResponse().getWriter().write(o.toString());
        event.getResource().getResponse().getWriter().flush();
      }
    }
    Boolean resumeOnBroadcast=(Boolean)event.getResource().getRequest().getAttribute(AtmosphereServlet.RESUME_ON_BROADCAST);
    if (resumeOnBroadcast != null && resumeOnBroadcast) {
      event.getResource().resume();
    }
  }
}
