{
  try {
    logger.debug("onException()",t);
    if (t instanceof IOException && r instanceof AtmosphereEventLifecycle) {
      ((AtmosphereEventLifecycle)r).notifyListeners(new AtmosphereResourceEventImpl((AtmosphereResourceImpl)r,true,false));
      ((AtmosphereEventLifecycle)r).removeEventListeners();
    }
  }
  finally {
    r.getBroadcaster().removeAtmosphereResource(r);
  }
}
