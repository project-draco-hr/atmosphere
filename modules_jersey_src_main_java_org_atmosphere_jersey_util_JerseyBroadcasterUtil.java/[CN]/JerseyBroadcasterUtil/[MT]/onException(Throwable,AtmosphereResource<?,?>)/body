{
  try {
    logger.debug("onException()",t);
    if (t instanceof IOException && r instanceof AtmosphereEventLifecycle) {
      ((AtmosphereEventLifecycle)r).notifyListeners(new AtmosphereResourceEventImpl((AtmosphereResourceImpl)r,true,false));
      ((AtmosphereEventLifecycle)r).removeEventListeners();
    }
  }
  finally {
    try {
      r.getBroadcaster().removeAtmosphereResource(r);
    }
 catch (    IllegalStateException ex) {
      logger.trace(ex.getMessage(),ex);
    }
    BroadcasterFactory.getDefault().removeAllAtmosphereResource(r);
  }
}
