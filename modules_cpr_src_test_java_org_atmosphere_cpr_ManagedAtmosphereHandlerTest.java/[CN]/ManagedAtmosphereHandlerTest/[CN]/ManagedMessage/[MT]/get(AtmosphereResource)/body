{
  r.set(resource);
  resource.addEventListener(new AtmosphereResourceEventListenerAdapter(){
    @Override public void onSuspend(    AtmosphereResourceEvent event){
      try {
        event.getResource().getBroadcaster().broadcast("message").get();
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
catch (      ExecutionException e) {
        e.printStackTrace();
      }
    }
  }
).suspend();
}
