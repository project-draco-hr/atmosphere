{
  readWriteLock.writeLock().lock();
  try {
    boolean hasMessageWithSameId=messagesIds.contains(message.id);
    if (!hasMessageWithSameId) {
      logger.trace("Added {} to the cache",message.message);
      CacheMessage cacheMessage=new CacheMessage(message.id,now,message.message);
      messages.add(cacheMessage);
      messagesIds.add(message.id);
    }
  }
  finally {
    readWriteLock.writeLock().unlock();
  }
}
