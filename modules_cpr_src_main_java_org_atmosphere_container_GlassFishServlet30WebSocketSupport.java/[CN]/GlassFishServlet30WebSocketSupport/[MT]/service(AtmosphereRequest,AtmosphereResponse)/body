{
  if (!Utils.webSocketEnabled(request)) {
    return super.service(request,response);
  }
 else {
    boolean webSocketNotSupported=request.getAttribute(WebSocket.WEBSOCKET_SUSPEND) == null;
    if (webSocketNotSupported) {
      response.addHeader(X_ATMOSPHERE_ERROR,"Websocket protocol not supported");
      response.sendError(501,"Websocket protocol not supported");
      return Action.CANCELLED;
    }
    return suspended(request,response);
  }
}
