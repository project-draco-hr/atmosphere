{
  AtmosphereRequest r=webSocketProtocol.onMessage(webSocket,data,offset,length);
  if (r != null) {
    AtmosphereResponse<WebSocket> w=new AtmosphereResponse<WebSocket>(webSocket,webSocketProtocol,r);
    try {
      dispatch(r,w);
    }
  finally {
      r.destroy();
      w.destroy();
    }
  }
}
