{
  if (request == null)   return;
  try {
    atmosphereServlet.doCometSupport(request,response);
  }
 catch (  IOException e) {
    logger.warn("Failed invoking atmosphere servlet doCometSupport()",e);
  }
catch (  ServletException e) {
    logger.warn("Failed invoking atmosphere servlet doCometSupport()",e);
  }
  resource=(AtmosphereResource)request.getAttribute(FrameworkConfig.ATMOSPHERE_RESOURCE);
  if (webSocket.atmosphereResource() == null && WebSocketAdapter.class.isAssignableFrom(webSocket.getClass())) {
    WebSocketAdapter.class.cast(webSocket).setAtmosphereResource(resource);
  }
  WebSocketHttpServletResponse r=WebSocketHttpServletResponse.class.cast(response);
  if (r.getStatus() >= 400) {
    webSocketProtocol.onError(webSocket,new WebSocketException("Status code higher than 400",r));
  }
}
