{
  try {
    atmosphereServlet().doCometSupport(new HttpServletRequestWrapper(request()){
      private ByteInputStream bis=new ByteInputStream(data,offset,length);
      private BufferedReader br=new BufferedReader(new StringReader(new String(data,"UTF-8")));
      @Override public String getMethod(){
        return methodType;
      }
      @Override public String getContentType(){
        return contentType;
      }
      @Override public Enumeration getHeaders(      String name){
        ArrayList list=Collections.list(super.getHeaders(name));
        if (name.equalsIgnoreCase("content-type")) {
          list.add(contentType);
        }
        return Collections.enumeration(list);
      }
      public Enumeration<String> getHeaderNames(){
        ArrayList list=Collections.list(super.getHeaderNames());
        list.add("content-type");
        return Collections.enumeration(list);
      }
      @Override public String getHeader(      String s){
        if (s.equalsIgnoreCase("Connection")) {
          return "keep-alive";
        }
 else         if ("content-type".equalsIgnoreCase(s)) {
          return contentType;
        }
 else {
          return super.getHeader(s);
        }
      }
      @Override public ServletInputStream getInputStream() throws IOException {
        return bis;
      }
      @Override public BufferedReader getReader() throws IOException {
        return br;
      }
    }
,new WebSocketHttpServletResponse<WebSocketSupport>(webSocketSupport()));
  }
 catch (  IOException e) {
    logger.warn(e.getMessage(),e);
  }
catch (  ServletException e) {
    logger.warn(e.getMessage(),e);
  }
}
