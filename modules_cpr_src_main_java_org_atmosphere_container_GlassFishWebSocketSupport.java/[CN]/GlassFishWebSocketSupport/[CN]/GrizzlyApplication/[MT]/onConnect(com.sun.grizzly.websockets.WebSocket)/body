{
  super.onConnect(w);
  if (!DefaultWebSocket.class.isAssignableFrom(w.getClass())) {
    throw new IllegalStateException();
  }
  DefaultWebSocket webSocket=DefaultWebSocket.class.cast(w);
  try {
    webSocketProcessor=new WebSocketProcessor(config.getServlet(),new GrizzlyWebSocket(webSocket),config.getServlet().getWebSocketProtocol());
    webSocketProcessor.dispatch(AtmosphereRequest.wrap(webSocket.getRequest()));
  }
 catch (  Exception e) {
    logger.warn("failed to connect to web socket",e);
  }
}
