{
  framework().interceptor(new CometdAtmosphereInterceptor());
  framework().setUseStreamForFlushingComments(false);
  if (sc.getServletContext().getServerInfo().contains("jetty")) {
    framework().setAsyncSupport(new JettyAsyncSupport(framework().getAtmosphereConfig()));
  }
  framework().addInitParameter("transports",WebSocketTransport.class.getName());
  framework().addInitParameter(ApplicationConfig.WEBSOCKET_CONTENT_TYPE,"application/json");
  super.init(sc);
  ReflectorServletProcessor r=new ReflectorServletProcessor();
  r.setServletClassName(org.cometd.java.annotation.AnnotationCometdServlet.class.getName());
  framework.addAtmosphereHandler("/*",r).initAtmosphereHandler(framework().getServletConfig());
}
