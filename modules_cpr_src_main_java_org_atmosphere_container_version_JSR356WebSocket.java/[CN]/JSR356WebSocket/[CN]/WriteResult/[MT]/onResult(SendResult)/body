{
  semaphore.release();
  if (!result.isOK() || result.getException() != null) {
    logger.trace("WebSocket {} failed to write {}",r,message);
    Broadcaster b=r.getBroadcaster();
    b.getBroadcasterConfig().getBroadcasterCache().addToCache(b.getID(),r,new BroadcastMessage(message));
  }
}
