{
  getResponse().setContentType("text/html");
  String origin=getRequest().getHeader("Origin");
  if (origin != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("Origin: " + origin);
    }
    getResponse().setHeader("Access-Control-Allow-Origin",origin);
  }
  super.initiate();
  writer.append(HEAD);
  String domain=getRequest().getParameter("d");
  if (domain != null) {
    writer.append("document.domain='");
    writer.append(domain);
    writer.append("';");
  }
  writer.append(MID);
  writer.append(Integer.toString(resource.getHeartBeatInterval()));
  writer.append(',').append(String.valueOf(connectionID));
  writer.append(TAIL);
}
