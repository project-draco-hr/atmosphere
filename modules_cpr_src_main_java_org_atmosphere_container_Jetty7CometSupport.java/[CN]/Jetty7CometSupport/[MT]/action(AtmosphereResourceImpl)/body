{
  super.action(r);
  ServletRequest request=r.getRequest(false);
  while (request != null) {
    try {
      Continuation c=(Continuation)request.getAttribute(Continuation.class.getName());
      if (c != null) {
        try {
          if (c.isSuspended()) {
            c.complete();
          }
        }
 catch (        IllegalStateException ex) {
          logger.trace("c.complete()",ex);
        }
 finally {
          r.getRequest(false).setAttribute(FrameworkConfig.CANCEL_SUSPEND_OPERATION,true);
        }
        request.removeAttribute(Continuation.class.getName());
        return;
      }
 else {
        if (AtmosphereRequest.class.isAssignableFrom(request.getClass())) {
          request=AtmosphereRequest.class.cast(request).getRequest();
        }
 else {
          return;
        }
      }
    }
 catch (    Throwable t) {
      logger.trace("action",t);
    }
  }
}
